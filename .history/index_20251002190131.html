<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pengeluaranqu - Kelola Keuangan Harian dengan Mudah</title>
    <meta
      name="description"
      content="Aplikasi PWA sederhana untuk mencatat pemasukan dan pengeluaran harian. Gratis, mudah digunakan, dan bisa diakses offline."
    />
    <meta name="theme-color" content="#2196F3" />

    <!-- Enhanced Security Headers (frame-ancestors and X-Frame-Options removed - only work via HTTP headers) -->
    <meta
      http-equiv="Content-Security-Policy"
      content="
      default-src 'self';
      script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
      style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline';
      font-src 'self' https://cdnjs.cloudflare.com;
      img-src 'self' data:;
      connect-src 'self' ws:;
    "
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta
      http-equiv="Referrer-Policy"
      content="strict-origin-when-cross-origin"
    />
    <meta
      http-equiv="Permissions-Policy"
      content="camera=(), microphone=(), geolocation=()"
    />

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon-192x192.svg" />
    <link rel="apple-touch-icon" href="icons/icon-192x192.svg" />

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="css/notification.css" />
    <link rel="stylesheet" href="css/profile-v2.css" />
    <link rel="stylesheet" href="css/profile-stats.css" />
    <link rel="stylesheet" href="css/budget.css" />
    <link rel="stylesheet" href="css/welcome-tips.css" />
    <!-- Font Awesome untuk Ikon -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Chart.js -->
    <!-- Chart.js -->
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Modern Auth Screen -->
    <div id="authScreen" class="auth-screen active">
      <!-- Background Elements -->
      <div class="auth-background">
        <div class="bg-gradient"></div>
        <div class="bg-pattern"></div>
        <div class="floating-elements">
          <div class="floating-element element-1">ğŸ’°</div>
          <div class="floating-element element-2">ğŸ“Š</div>
          <div class="floating-element element-3">ğŸ’³</div>
          <div class="floating-element element-4">ğŸ“ˆ</div>
          <div class="floating-element element-5">ğŸ¯</div>
        </div>
      </div>

      <div class="auth-container">
        <!-- Enhanced Logo Section -->
        <div class="auth-header">
          <div class="logo-modern">
            <div class="logo-icon-wrapper">
              <div class="logo-icon">ğŸ’°</div>
              <div class="logo-pulse"></div>
            </div>
            <div class="logo-text">
              <h1>Pengeluaranqu</h1>
              <p class="tagline">Smart Financial Management</p>
            </div>
          </div>
          
          <!-- Feature Highlights -->
          <div class="feature-highlights">
            <div class="feature-item">
              <span class="feature-icon">ğŸ“±</span>
              <span class="feature-text">Offline Ready</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">ğŸ”’</span>
              <span class="feature-text">Secure</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">ğŸ“Š</span>
              <span class="feature-text">Smart Analytics</span>
            </div>
          </div>
        </div>

        <!-- Modern Login Form -->
        <div id="loginForm" class="auth-form active">
          <div class="form-header">
            <h2>Welcome Back</h2>
            <p class="form-subtitle">Sign in to continue managing your finances</p>
          </div>
          
          <form id="loginFormElement" class="modern-form" onsubmit="handleLogin(event)">
            <div class="input-group">
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                  </svg>
                </div>
                <input
                  type="email"
                  id="loginEmail"
                  name="email"
                  required
                  placeholder="Enter your email address"
                  class="modern-input"
                />
                <label for="loginEmail" class="floating-label">Email Address</label>
              </div>
            </div>
            
            <div class="input-group">
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <circle cx="12" cy="16" r="1"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                  </svg>
                </div>
                <input
                  type="password"
                  id="loginPassword"
                  name="password"
                  required
                  placeholder="Enter your password"
                  class="modern-input"
                />
                <label for="loginPassword" class="floating-label">Password</label>
                <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
              </div>
            </div>

            <div class="form-options">
              <label class="checkbox-wrapper">
                <input type="checkbox" id="rememberMe">
                <span class="checkmark"></span>
                <span class="checkbox-text">Remember me</span>
              </label>
              <a href="#" class="forgot-password" onclick="showForgotPassword()">Forgot Password?</a>
            </div>

            <button type="submit" class="btn-primary-modern">
              <span class="btn-text">Sign In</span>
              <div class="btn-loader">
                <div class="loader-dot"></div>
                <div class="loader-dot"></div>
                <div class="loader-dot"></div>
              </div>
            </button>
          </form>

          <div class="auth-divider">
            <span class="divider-line"></span>
            <span class="divider-text">or continue with</span>
            <span class="divider-line"></span>
          </div>

          <div class="social-login-buttons">
            <button class="btn-social btn-google" onclick="signInWithGoogle()">
              <div class="social-icon">
                <svg width="20" height="20" viewBox="0 0 24 24">
                  <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
              </div>
              <span>Continue with Google</span>
            </button>

            <button class="btn-social btn-facebook" onclick="signInWithFacebook()">
              <div class="social-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#1877F2">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
              </div>
              <span>Continue with Facebook</span>
            </button>
          </div>

          <div class="auth-footer">
            <p>Don't have an account? <a href="#" onclick="showRegister()" class="auth-link">Create Account</a></p>
          </div>
            Masuk dengan Google
          </button>

          <p class="auth-switch">
            Belum punya akun?
            <button type="button" onclick="showRegister()" class="btn-text">
              Daftar di sini
            </button>
          </p>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="auth-form">
          <h2>Buat Akun Baru</h2>
          <form id="registerFormElement">
            <div class="form-group">
              <label for="registerName">Nama</label>
              <input
                type="text"
                id="registerName"
                name="name"
                required
                placeholder="Nama lengkap"
              />
            </div>
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input
                type="email"
                id="registerEmail"
                name="email"
                required
                placeholder="nama@email.com"
              />
            </div>
            <div class="form-group">
              <label for="registerPassword">Kata Sandi</label>
              <input
                type="password"
                id="registerPassword"
                name="password"
                required
                placeholder="Minimal 6 karakter"
              />
            </div>
            <div class="form-group">
              <label for="confirmPassword">Konfirmasi Kata Sandi</label>
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                required
                placeholder="Ulangi kata sandi"
              />
            </div>
            <button type="submit" class="btn-primary">Daftar</button>
          </form>

          <div class="auth-divider">
            <span>atau</span>
          </div>

          <button class="btn-google" onclick="registerWithGoogle()">
            ğŸ” Daftar dengan Google
          </button>

          <p class="auth-switch">
            Sudah punya akun?
            <button type="button" onclick="showLogin()" class="btn-text">
              Masuk di sini
            </button>
          </p>
        </div>
      </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="main-app">
      <!-- Header -->
      <header class="header">
        <div class="container">
          <h1
            class="logo clickable-logo"
            onclick="window.app.showSection('dashboard')"
          >
            ğŸ’° Pengeluaranqu
          </h1>
          <div class="header-actions">
            <div class="user-info">
              <div class="user-greeting">
                <span class="greeting-text" id="greetingText"
                  >Selamat datang,</span
                >
                <span class="user-name" id="userName">Pengguna</span>
              </div>
              <button
                class="guest-badge upgrade-btn"
                id="guestBadge"
                style="display: none"
                onclick="window.app.upgradeFromGuest()"
                title="Klik untuk upgrade ke akun permanen"
              >
                ğŸ‘¤ Tamu - Upgrade
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content active">
          <div class="container">
            <!-- Balance Card -->
            <div class="balance-card">
              <div class="balance-header">
                <h2>Saldo Anda</h2>
                <span class="balance-date" id="balanceDate">Per hari ini</span>
              </div>
              <div class="balance-amount-large" id="dashboardBalance">Rp 0</div>
              <div class="balance-details">
                <div class="balance-item income">
                  <span class="label">Pemasukan Bulan Ini</span>
                  <span class="amount" id="monthIncome">Rp 0</span>
                </div>
                <div class="balance-item expense">
                  <span class="label">Pengeluaran Bulan Ini</span>
                  <span class="amount" id="monthExpense">Rp 0</span>
                </div>
              </div>
            </div>

            <!-- Budget Progress (F6 requirement) -->
            <div class="budget-section">
              <!-- Diisi oleh updateBudget() -->
            </div>

            <!-- Category Budgets Section -->
            <div class="section" id="categoryBudgetsSection">
              <div class="section-header">
                <h3>ğŸ¯ Anggaran per Kategori</h3>
                <div class="section-actions">
                  <button
                    class="btn-secondary premium-feature"
                    onclick="checkPremiumFeature('categoryBudgets')"
                  >
                    â• Tambah Anggaran
                    <span class="premium-badge">â­</span>
                  </button>
                </div>
              </div>
              <div id="categoryBudgetsList" class="category-budgets-list">
                <div class="empty-state">
                  ğŸ¯ <br />
                  <p>Belum ada anggaran kategori</p>
                  <small
                    >Upgrade ke Premium untuk mengatur anggaran per
                    kategori</small
                  >
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
              <button
                class="quick-action-btn income"
                data-type="income"
                data-action="quick-add"
              >
                â• Tambah Pemasukan
              </button>
              <button
                class="quick-action-btn expense"
                data-type="expense"
                data-action="quick-add"
              >
                â– Tambah Pengeluaran
              </button>
            </div>
            <div class="dashboard-grid">
              <!-- Category Breakdown (F4 requirement) -->
              <div class="section">
                <div class="section-header">
                  <h3>ğŸ“Š Pengeluaran per Kategori</h3>
                  <span class="balance-date">Bulan ini</span>
                </div>
                <div class="chart-container-simple">
                  <canvas
                    id="dashboardCategoryChart"
                    width="300"
                    height="300"
                  ></canvas>
                </div>
                <div id="categoryBreakdown" class="category-breakdown">
                  <div class="empty-state">
                    ğŸ“Š
                    <p>Belum ada pengeluaran bulan ini</p>
                    <small
                      >Mulai catat pengeluaran untuk melihat distribusi
                      kategori</small
                    >
                  </div>
                </div>
              </div>

              <!-- Recent Transactions -->
              <div class="section">
                <div class="section-header">
                  <h3>Transaksi Terkini</h3>
                  <button class="btn-text" data-tab="history">
                    Lihat Semua
                  </button>
                </div>
                <div id="recentTransactions" class="transaction-list">
                  <div class="empty-state">
                    ğŸ“­
                    <p>Belum ada transaksi hari ini</p>
                    <button class="btn-secondary" data-tab="add-transaction">
                      ğŸš€ Mulai Catat
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Add Transaction Tab -->
        <section id="add-transaction" class="tab-content">
          <div class="container">
            <div class="transaction-type-tabs">
              <button class="type-tab active" data-type="expense">
                â– Pengeluaran
              </button>
              <button class="type-tab" data-type="income">â• Pemasukan</button>
            </div>

            <form id="transactionForm" class="transaction-form">
              <input
                type="hidden"
                id="transactionType"
                name="type"
                value="expense"
              />

              <div class="form-group">
                <label for="amount">ğŸ’° Jumlah</label>
                <div class="amount-input">
                  <span class="currency">Rp</span>
                  <input
                    type="text"
                    inputmode="numeric"
                    id="amount"
                    name="amount"
                    placeholder="0"
                    required
                    autofocus
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="category">ğŸ“‚ Kategori</label>
                <select id="category" name="category" required>
                  <!-- Categories populated by JS -->
                </select>
              </div>

              <div class="form-group">
                <label for="description">ğŸ“ Deskripsi (opsional)</label>
                <input
                  type="text"
                  id="description"
                  name="description"
                  placeholder="Contoh: Makan siang di warung"
                />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="date">ğŸ“… Tanggal</label>
                  <input type="date" id="date" name="date" required />
                </div>

                <div class="form-group">
                  <label for="time">ğŸ• Waktu</label>
                  <input type="time" id="time" name="time" required />
                </div>
              </div>

              <button type="submit" class="btn-primary btn-large">
                ğŸ’¾ Simpan Transaksi
              </button>
            </form>
          </div>
        </section>

        <!-- History Tab -->
        <!-- Redirect Notice -->
        <section class="redirect-notice">
          <div class="container">
            <div class="notice-content">
              <h2>ğŸ”„ Mengalihkan...</h2>
              <p>Anda akan dialihkan ke dashboard dalam beberapa detik.</p>
              <p>
                <a href="dashboard.html"
                  >Klik di sini jika tidak teralihkan otomatis</a
                >
              </p>
            </div>
          </div>
        </section>
        <!-- Analytics Tab -->
        <section id="analytics" class="tab-content">
          <div class="container">
            <!-- Chart Controls -->
            <div class="chart-controls">
              <select id="chartPeriod">
                <option value="month">ğŸ“… Bulan Ini</option>
                <option value="week">ğŸ“… Minggu Ini</option>
                <option value="year">ğŸ“… Tahun Ini</option>
              </select>
              <button
                id="exportBtn"
                class="btn-secondary premium-feature"
                title="Fitur Premium"
                onclick="showPremiumFeature()"
              >
                ğŸ“¥ Export Data
              </button>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
              <div class="chart-container">
                <h3>ğŸ“Š Pengeluaran per Kategori</h3>
                <canvas id="categoryChart"></canvas>
              </div>
              <div class="chart-container">
                <h3>ğŸ“ˆ Tren Pemasukan vs Pengeluaran</h3>
                <canvas id="trendChart"></canvas>
              </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
              <div class="stat-card">
                <h4>ğŸ“Š Rata-rata Pengeluaran Harian</h4>
                <p class="stat-value" id="dailyAverage">Rp 0</p>
              </div>
              <div class="stat-card">
                <h4>ğŸ”¥ Kategori Pengeluaran Tertinggi</h4>
                <p class="stat-value" id="topCategory">-</p>
              </div>
              <div class="stat-card">
                <h4>ğŸ“‹ Total Transaksi</h4>
                <p class="stat-value" id="totalTransactions">0</p>
              </div>
              <div class="stat-card">
                <h4>ğŸ’° Rasio Menabung</h4>
                <p class="stat-value" id="savingsRatio">0%</p>
              </div>
            </div>

            <!-- Premium Features Ad -->
            <div class="premium-ad">
              <div class="premium-content">
                <h3>ğŸš€ Upgrade ke Premium</h3>
                <p>
                  Dapatkan laporan detail, export data, dan fitur analisis
                  lanjutan
                </p>
                <ul>
                  <li>âœ… Export ke CSV dan PDF</li>
                  <li>âœ… Anggaran kategori tanpa batas</li>
                  <li>âœ… Analisis tren mendalam</li>
                  <li>âœ… Sinkronisasi antar perangkat</li>
                </ul>
                <button class="btn-premium" onclick="showPremiumFeature()">
                  ğŸ‘‘ Upgrade Sekarang - Rp 29.000/bulan
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Analytics Tab (Premium Feature) -->
        <section id="analytics" class="tab-content">
          <div class="container">
            <div class="analytics-header">
              <h2>ğŸ“Š Analisis Keuangan Lanjutan</h2>
              <div class="premium-indicator">
                <span class="premium-badge">â­ Fitur Premium</span>
              </div>
            </div>

            <!-- Free User Teaser -->
            <div class="analytics-teaser" id="analyticsTeaser">
              <div class="teaser-content">
                <div class="teaser-preview">
                  <h3>ğŸ¯ Wawasan Keuangan yang Lebih Mendalam</h3>
                  <div class="preview-cards">
                    <div class="preview-card blurred">
                      <h4>ğŸ“ˆ Tren Pengeluaran</h4>
                      <div class="fake-chart">
                        <div class="chart-line"></div>
                        <span class="chart-label">Analisis 12 bulan</span>
                      </div>
                    </div>
                    <div class="preview-card blurred">
                      <h4>ğŸ’° Prediksi Anggaran</h4>
                      <div class="fake-stats">
                        <div class="stat-bar"></div>
                        <span class="stat-label">Estimasi bulan depan</span>
                      </div>
                    </div>
                    <div class="preview-card blurred">
                      <h4>ğŸ† Kategori Favorit</h4>
                      <div class="fake-pie">
                        <div class="pie-slice"></div>
                        <span class="pie-label">Breakdown detail</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="teaser-features">
                  <h4>Yang Anda Dapatkan dengan Premium:</h4>
                  <ul class="feature-list">
                    <li>ğŸ“Š Grafik tren pengeluaran 12 bulan</li>
                    <li>ğŸ¯ Prediksi anggaran bulan depan</li>
                    <li>ğŸ“ˆ Analisis perbandingan periode</li>
                    <li>ğŸ† Ranking kategori pengeluaran</li>
                    <li>ğŸ’¡ Rekomendasi penghematan personal</li>
                    <li>ğŸ“± Laporan weekly dan monthly</li>
                    <li>ğŸ“„ Export laporan ke PDF/Excel</li>
                    <li>ğŸ¨ Visualisasi data yang menarik</li>
                  </ul>
                </div>

                <div class="teaser-cta">
                  <button
                    class="btn-premium-large"
                    onclick="PremiumFeatures.showPricingPlans()"
                  >
                    ğŸš€ Unlock Analytics Premium
                    <span class="price-tag">Mulai Rp 29.000/bulan</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Premium Analytics Content (Hidden for free users) -->
            <div
              class="analytics-content premium-only"
              id="analyticsContent"
              style="display: none"
            >
              <!-- Trend Analysis -->
              <div class="analytics-section">
                <h3>ğŸ“ˆ Analisis Tren Pengeluaran</h3>
                <div class="chart-container">
                  <canvas id="trendChart" width="400" height="200"></canvas>
                </div>
                <div class="trend-insights">
                  <div class="insight-card">
                    <h4>ğŸ“Š Tren Bulan Ini</h4>
                    <p id="monthlyTrend">Loading...</p>
                  </div>
                  <div class="insight-card">
                    <h4>ğŸ’¡ Rekomendasi</h4>
                    <p id="trendRecommendation">Loading...</p>
                  </div>
                </div>
              </div>

              <!-- Category Analysis -->
              <div class="analytics-section">
                <h3>ğŸ† Analisis Kategori Detail</h3>
                <div class="category-breakdown">
                  <div class="chart-container">
                    <canvas
                      id="categoryTrendChart"
                      width="400"
                      height="200"
                    ></canvas>
                  </div>
                  <div class="category-stats" id="categoryAnalytics">
                    <!-- Dynamic content -->
                  </div>
                </div>
              </div>

              <!-- Predictions -->
              <div class="analytics-section">
                <h3>ğŸ”® Prediksi Keuangan</h3>
                <div class="prediction-grid">
                  <div class="prediction-card">
                    <h4>ğŸ“… Estimasi Bulan Depan</h4>
                    <div class="prediction-value" id="nextMonthPrediction">
                      Rp 0
                    </div>
                    <div class="prediction-confidence">
                      Akurasi: <span id="predictionAccuracy">85%</span>
                    </div>
                  </div>
                  <div class="prediction-card">
                    <h4>ğŸ’° Target Penghematan</h4>
                    <div class="prediction-value" id="savingsTarget">Rp 0</div>
                    <div class="prediction-confidence">
                      Potensi: <span id="savingsPotential">15%</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Export Options -->
              <div class="analytics-section">
                <h3>ğŸ“„ Export Laporan</h3>
                <div class="export-options">
                  <button class="btn-export" onclick="exportAnalytics('pdf')">
                    ğŸ“„ Export PDF
                  </button>
                  <button class="btn-export" onclick="exportAnalytics('excel')">
                    ğŸ“Š Export Excel
                  </button>
                  <button class="btn-export" onclick="exportAnalytics('csv')">
                    ğŸ“‹ Export CSV
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Profile Tab -->
        <section id="profile" class="tab-content">
          <div class="section-header">
            <h1>ğŸ‘¤ Profil Pengguna</h1>
          </div>
          <div id="profileContent" class="profile-content"></div>
        </section>
      </main>

      <!-- Bottom Navigation -->
      <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="dashboard">
          ğŸ <br />Dashboard
        </button>
        <button class="nav-tab" data-tab="add-transaction" id="quickAddBtn">
          â•<br />Tambah
        </button>
        <button class="nav-tab" data-tab="history">ğŸ“‹<br />Riwayat</button>
        <button
          class="nav-tab premium-feature"
          data-tab="analytics"
          onclick="checkPremiumFeature('advancedReports')"
        >
          ğŸ“Š<br />Analisis
          <span class="premium-badge">â­</span>
        </button>
        <button class="nav-tab" data-tab="profile">ğŸ‘¤<br />Profil</button>
      </nav>
    </div>

    <!-- Quick Add Floating Button (FR-002: Fast Input) -->
    <button
      id="quickAddFloat"
      class="quick-add-floating"
      onclick="showQuickAdd('expense')"
      title="Tambah Pengeluaran Cepat"
    >
      â•
    </button>

    <!-- Modals -->
    <!-- Edit Transaction Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>âœï¸ Edit Transaksi</h3>
          <button class="modal-close" onclick="closeModal('editModal')">
            &times;
          </button>
        </div>
        <form id="editForm" class="modal-form">
          <input type="hidden" id="editId" name="id" />
          <input type="hidden" id="editType" name="type" />

          <div class="form-group">
            <label for="editAmount">ğŸ’° Jumlah</label>
            <div class="amount-input">
              <span class="currency">Rp</span>
              <input
                type="text"
                inputmode="numeric"
                id="editAmount"
                name="amount"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="editCategory">ğŸ“‚ Kategori</label>
            <select id="editCategory" name="category" required>
              <!-- Categories populated by JS -->
            </select>
          </div>

          <div class="form-group">
            <label for="editDescription">ğŸ“ Deskripsi</label>
            <input type="text" id="editDescription" name="description" />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="editDate">ğŸ“… Tanggal</label>
              <input type="date" id="editDate" name="date" required />
            </div>
            <div class="form-group">
              <label for="editTime">ğŸ• Waktu</label>
              <input type="time" id="editTime" name="time" required />
            </div>
          </div>

          <div class="modal-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeModal('editModal')"
            >
              âŒ Batal
            </button>
            <button type="submit" class="btn-primary">ğŸ’¾ Simpan</button>
            <button type="button" class="btn-danger" id="deleteBtn">
              ğŸ—‘ï¸ Hapus
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Quick Add Modal -->
    <div id="quickAddModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="quickAddTitle">â• Tambah Transaksi</h3>
          <button class="modal-close" onclick="closeModal('quickAddModal')">
            &times;
          </button>
        </div>
        <form id="quickAddForm" class="modal-form">
          <input type="hidden" id="quickAddType" name="type" />

          <div class="form-group">
            <label for="quickAddAmount">ğŸ’° Jumlah</label>
            <div class="amount-input">
              <span class="currency">Rp</span>
              <input
                type="text"
                inputmode="numeric"
                id="quickAddAmount"
                name="amount"
                required
                placeholder="0"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="quickAddCategory">ğŸ“‚ Kategori</label>
            <select id="quickAddCategory" name="category" required>
              <!-- Categories populated by JS -->
            </select>
          </div>

          <div class="form-group">
            <label for="quickAddDescription">ğŸ“ Deskripsi (opsional)</label>
            <input
              type="text"
              id="quickAddDescription"
              name="description"
              placeholder="Catatan singkat"
            />
          </div>

          <div class="modal-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeModal('quickAddModal')"
            >
              âŒ Batal
            </button>
            <button type="submit" class="btn-primary">ğŸ’¾ Simpan</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Budget Modal (F6 requirement) -->
    <div id="budgetModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ¯ Atur Anggaran Bulanan</h3>
          <button class="modal-close" onclick="closeModal('budgetModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="budgetForm">
            <div class="form-group">
              <label for="budget-month">ğŸ“… Bulan Anggaran</label>
              <input
                type="month"
                id="budget-month"
                name="budget-month"
                required
              />
              <small class="form-help">Pilih bulan untuk anggaran ini.</small>
            </div>
            <div class="form-group">
              <label for="monthlyBudget">ğŸ’° Anggaran Bulanan</label>
              <div class="amount-input">
                <span class="currency">Rp</span>
                <input
                  type="text"
                  inputmode="numeric"
                  id="monthlyBudget"
                  name="budget"
                  placeholder="0"
                  required
                />
              </div>
              <small class="form-help">
                Tetapkan target maksimal pengeluaran per bulan. Isi 0 untuk
                menghapus anggaran.
              </small>
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('budgetModal')"
              >
                Batal
              </button>
              <button type="submit" class="btn-primary">
                ğŸ’¾ Simpan Anggaran
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Category Budget Modal -->
    <div id="categoryBudgetModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ¯ Atur Anggaran Kategori</h3>
          <button
            class="modal-close"
            onclick="closeModal('categoryBudgetModal')"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="categoryBudgetForm">
            <div class="form-group">
              <label for="budgetCategory">ğŸ“‚ Pilih Kategori</label>
              <select id="budgetCategory" name="category" required>
                <option value="">-- Pilih Kategori --</option>
                <!-- Populated by JavaScript -->
              </select>
            </div>
            <div class="form-group">
              <label for="categoryBudgetAmount">ğŸ’° Jumlah Anggaran</label>
              <div class="amount-input">
                <span class="currency">Rp</span>
                <input
                  type="text"
                  inputmode="numeric"
                  id="categoryBudgetAmount"
                  name="amount"
                  placeholder="0"
                  required
                />
              </div>
              <small class="form-help">
                Tentukan batas maksimal pengeluaran untuk kategori ini
              </small>
            </div>
            <div class="form-group">
              <label for="budgetPeriod">ğŸ“… Periode</label>
              <select id="budgetPeriod" name="period">
                <option value="monthly">Bulanan</option>
                <option value="weekly">Mingguan</option>
                <option value="daily">Harian</option>
              </select>
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('categoryBudgetModal')"
              >
                Batal
              </button>
              <button type="submit" class="btn-primary">
                ğŸ’¾ Simpan Anggaran
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/security.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/enhanced-features.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/welcome-tips.js"></script>
    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/charts.js"></script>

    <script>
      // Modern Authentication Functions
      
      // Toggle password visibility
      function togglePassword(passwordInputId) {
        const passwordInput = document.getElementById(passwordInputId);
        const toggleButton = passwordInput.parentNode.querySelector('.password-toggle');
        
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
          passwordInput.type = 'password';
          toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
        }
      }

      // Show forgot password form
      function showForgotPassword() {
        const authContainer = document.querySelector('.auth-container');
        const loginForm = document.getElementById('loginForm');
        
        // Hide login form
        loginForm.style.display = 'none';
        
        // Create and show forgot password form
        const forgotPasswordHTML = `
          <div class="form-container" id="forgotPasswordForm">
            <div class="form-header">
              <h2>Reset Password</h2>
              <p>Enter your email to receive a reset link</p>
            </div>
            
            <form onsubmit="handleForgotPassword(event)">
              <div class="form-group">
                <div class="input-group">
                  <input type="email" id="resetEmail" required>
                  <label for="resetEmail">Email Address</label>
                  <span class="input-icon">
                    <i class="fas fa-envelope"></i>
                  </span>
                </div>
              </div>
              
              <button type="submit" class="btn-primary">
                Send Reset Link
              </button>
            </form>
            
            <div class="auth-footer">
              <p>Remember your password? <a href="#" onclick="showLogin()" class="auth-link">Back to Login</a></p>
            </div>
          </div>
        `;
        
        authContainer.insertAdjacentHTML('beforeend', forgotPasswordHTML);
      }

      // Show registration form
      function showRegister() {
        const authContainer = document.querySelector('.auth-container');
        const loginForm = document.getElementById('loginForm');
        
        // Hide login form
        loginForm.style.display = 'none';
        
        // Create and show registration form
        const registerHTML = `
          <div class="form-container" id="registerForm">
            <div class="form-header">
              <h2>Create Account</h2>
              <p>Join us and start tracking your expenses</p>
            </div>
            
            <form onsubmit="handleRegister(event)">
              <div class="form-group">
                <div class="input-group">
                  <input type="text" id="registerName" required>
                  <label for="registerName">Full Name</label>
                  <span class="input-icon">
                    <i class="fas fa-user"></i>
                  </span>
                </div>
              </div>

              <div class="form-group">
                <div class="input-group">
                  <input type="email" id="registerEmail" required>
                  <label for="registerEmail">Email Address</label>
                  <span class="input-icon">
                    <i class="fas fa-envelope"></i>
                  </span>
                </div>
              </div>

              <div class="form-group">
                <div class="input-group">
                  <input type="password" id="registerPassword" required>
                  <label for="registerPassword">Password</label>
                  <span class="input-icon">
                    <i class="fas fa-lock"></i>
                  </span>
                  <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>

              <div class="form-group">
                <div class="input-group">
                  <input type="password" id="confirmPassword" required>
                  <label for="confirmPassword">Confirm Password</label>
                  <span class="input-icon">
                    <i class="fas fa-lock"></i>
                  </span>
                  <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              
              <button type="submit" class="btn-primary">
                Create Account
              </button>
            </form>
            
            <div class="divider">
              <span>or</span>
            </div>
            
            <div class="social-login">
              <button type="button" class="btn-social google" onclick="signUpWithGoogle()">
                <i class="fab fa-google"></i>
                Sign up with Google
              </button>
              <button type="button" class="btn-social facebook" onclick="signUpWithFacebook()">
                <i class="fab fa-facebook-f"></i>
                Sign up with Facebook
              </button>
            </div>
            
            <div class="auth-footer">
              <p>Already have an account? <a href="#" onclick="showLogin()" class="auth-link">Sign In</a></p>
            </div>
          </div>
        `;
        
        authContainer.insertAdjacentHTML('beforeend', registerHTML);
      }

      // Show login form (back from register/forgot password)
      function showLogin() {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        
        // Show login form
        loginForm.style.display = 'block';
        
        // Remove other forms
        if (registerForm) registerForm.remove();
        if (forgotPasswordForm) forgotPasswordForm.remove();
      }

      // Handle login form submission
      function handleLogin(event) {
        event.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const submitButton = event.target.querySelector('button[type="submit"]');
        
        // Show loading state
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
        submitButton.disabled = true;
        
        // Simulate authentication (replace with real auth)
        setTimeout(() => {
          // Store user info (basic simulation)
          localStorage.setItem('userEmail', email);
          localStorage.setItem('userName', email.split('@')[0]);
          
          // Redirect to dashboard
          window.location.href = 'dashboard.html';
        }, 1500);
      }

      // Handle registration form submission
      function handleRegister(event) {
        event.preventDefault();
        
        const name = document.getElementById('registerName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const submitButton = event.target.querySelector('button[type="submit"]');
        
        // Validate passwords match
        if (password !== confirmPassword) {
          alert('Passwords do not match!');
          return;
        }
        
        // Show loading state
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
        submitButton.disabled = true;
        
        // Simulate registration (replace with real auth)
        setTimeout(() => {
          // Store user info
          localStorage.setItem('userEmail', email);
          localStorage.setItem('userName', name);
          
          // Redirect to dashboard
          window.location.href = 'dashboard.html';
        }, 2000);
      }

      // Handle forgot password form submission
      function handleForgotPassword(event) {
        event.preventDefault();
        
        const email = document.getElementById('resetEmail').value;
        const submitButton = event.target.querySelector('button[type="submit"]');
        
        // Show loading state
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        submitButton.disabled = true;
        
        // Simulate sending reset email
        setTimeout(() => {
          alert('Reset link sent to ' + email + '!');
          showLogin();
        }, 1500);
      }

      // Social login functions
      function signInWithGoogle() {
        alert('Google sign-in would be implemented here');
        // Implement Google OAuth
      }

      function signInWithFacebook() {
        alert('Facebook sign-in would be implemented here');
        // Implement Facebook OAuth
      }

      function signUpWithGoogle() {
        alert('Google sign-up would be implemented here');
        // Implement Google OAuth for signup
      }

      function signUpWithFacebook() {
        alert('Facebook sign-up would be implemented here');
        // Implement Facebook OAuth for signup
      }

      // Initialize application
      document.addEventListener("DOMContentLoaded", function () {
        // Set up service worker
        if ("serviceWorker" in navigator) {
          window.addEventListener("load", function () {
            navigator.serviceWorker
              .register("sw.js")
              .then(function (registration) {
                console.log("SW registered with scope: ", registration.scope);
              })
              .catch(function (err) {
                console.log("SW registration failed: ", err);
              });
          });
        }

        // Check if user is already logged in
        const userEmail = localStorage.getItem('userEmail');
        if (userEmail) {
          // User already logged in, redirect to dashboard
          window.location.href = 'dashboard.html';
        }

        // Add form submission handler to login form
        const loginForm = document.querySelector('#loginForm form');
        if (loginForm) {
          loginForm.addEventListener('submit', handleLogin);
        }
      });
    </script>
  </body>
</html>
