<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pengeluaranqu - Kelola Keuangan Harian dengan Mudah</title>
    <meta
      name="description"
      content="Aplikasi PWA sederhana untuk mencatat pemasukan dan pengeluaran harian. Gratis, mudah digunakan, dan bisa diakses offline."
    />
    <meta name="theme-color" content="#2196F3" />

    <!-- Enhanced Security Headers (frame-ancestors and X-Frame-Options removed - only work via HTTP headers) -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https:; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta
      http-equiv="Referrer-Policy"
      content="strict-origin-when-cross-origin"
    />
    <meta
      http-equiv="Permissions-Policy"
      content="camera=(), microphone=(), geolocation=()"
    />

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon-192x192.svg" />
    <link rel="apple-touch-icon" href="icons/icon-192x192.svg" />

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css" />

    <!-- Chart.js -->
    <!-- Chart.js -->
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen active">
      <div class="auth-container">
        <div class="auth-header">
          <div class="logo-large">
            <i class="icon-wallet"></i>
            <h1>Pengeluaranqu</h1>
            <p>Kelola keuangan harian dengan mudah</p>
          </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="auth-form active">
          <h2>Masuk ke Akun Anda</h2>
          <form id="loginFormElement">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input
                type="email"
                id="loginEmail"
                name="email"
                required
                placeholder="nama@email.com"
              />
            </div>
            <div class="form-group">
              <label for="loginPassword">Kata Sandi</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                required
                placeholder="Masukkan kata sandi"
              />
            </div>
            <button type="submit" class="btn-primary">Masuk</button>
          </form>

          <div class="auth-divider">
            <span>atau</span>
          </div>

          <button class="btn-guest" onclick="loginAsGuest()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="currentColor"
              style="margin-right: 8px"
            >
              <path
                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
              />
            </svg>
            Masuk sebagai Tamu
          </button>

          <button class="btn-google" onclick="loginWithGoogle()">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              style="margin-right: 12px"
            >
              <path
                fill="#4285F4"
                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
              />
              <path
                fill="#34A853"
                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
              />
              <path
                fill="#FBBC05"
                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
              />
              <path
                fill="#EA4335"
                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
              />
            </svg>
            Masuk dengan Google
          </button>

          <p class="auth-switch">
            Belum punya akun?
            <button type="button" onclick="showRegister()" class="btn-text">
              Daftar di sini
            </button>
          </p>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="auth-form">
          <h2>Buat Akun Baru</h2>
          <form id="registerFormElement">
            <div class="form-group">
              <label for="registerName">Nama</label>
              <input
                type="text"
                id="registerName"
                name="name"
                required
                placeholder="Nama lengkap"
              />
            </div>
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input
                type="email"
                id="registerEmail"
                name="email"
                required
                placeholder="nama@email.com"
              />
            </div>
            <div class="form-group">
              <label for="registerPassword">Kata Sandi</label>
              <input
                type="password"
                id="registerPassword"
                name="password"
                required
                placeholder="Minimal 6 karakter"
              />
            </div>
            <div class="form-group">
              <label for="confirmPassword">Konfirmasi Kata Sandi</label>
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                required
                placeholder="Ulangi kata sandi"
              />
            </div>
            <button type="submit" class="btn-primary">Daftar</button>
          </form>

          <div class="auth-divider">
            <span>atau</span>
          </div>

          <button class="btn-google" onclick="registerWithGoogle()">
            ğŸ” Daftar dengan Google
          </button>

          <p class="auth-switch">
            Sudah punya akun?
            <button type="button" onclick="showLogin()" class="btn-text">
              Masuk di sini
            </button>
          </p>
        </div>
      </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="main-app">
      <!-- Header -->
      <header class="header">
        <div class="container">
          <h1 class="logo">ğŸ’° Pengeluaranqu</h1>
          <div class="header-actions">
            <div class="user-info">
              <div class="user-balance">
                <span class="balance-label">Saldo</span>
                <span class="balance-amount" id="currentBalance">Rp 0</span>
              </div>
              <span class="user-name" id="userName">Pengguna</span>
              <button
                class="guest-badge upgrade-btn"
                id="guestBadge"
                style="display: none"
                onclick="window.app.upgradeFromGuest()"
                title="Klik untuk upgrade ke akun permanen"
              >
                ğŸ‘¤ Tamu - Upgrade
              </button>
            </div>
            <button
              id="profileBtn"
              class="btn-icon"
              title="Profil"
              onclick="openModal('profileModal')"
            >
              âš™ï¸
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content active">
          <div class="container">
            <!-- Balance Card -->
            <div class="balance-card">
              <div class="balance-header">
                <h2>Saldo Anda</h2>
                <span class="balance-date" id="balanceDate">Per hari ini</span>
              </div>
              <div class="balance-amount-large" id="dashboardBalance">Rp 0</div>
              <div class="balance-details">
                <div class="balance-item income">
                  <span class="label">Pemasukan Bulan Ini</span>
                  <span class="amount" id="monthIncome">Rp 0</span>
                </div>
                <div class="balance-item expense">
                  <span class="label">Pengeluaran Bulan Ini</span>
                  <span class="amount" id="monthExpense">Rp 0</span>
                </div>
              </div>
            </div>

            <!-- Budget Progress (F6 requirement) -->
            <div class="budget-card">
              <div class="budget-header">
                <h3>ğŸ¯ Anggaran Bulan Ini</h3>
                <button class="btn-text" onclick="openModal('budgetModal')">
                  Atur
                </button>
              </div>
              <div id="budgetProgress" class="budget-progress">
                <div class="budget-bar">
                  <div
                    class="budget-used"
                    id="budgetBar"
                    style="width: 0%"
                  ></div>
                </div>
                <div class="budget-info">
                  <span id="budgetUsed">Rp 0</span>
                  <span>dari</span>
                  <span id="budgetTotal">Rp 0</span>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
              <button
                class="quick-action-btn income"
                onclick="showQuickAdd('income')"
              >
                â• Tambah Pemasukan
              </button>
              <button
                class="quick-action-btn expense"
                onclick="showQuickAdd('expense')"
              >
                â– Tambah Pengeluaran
              </button>
            </div>

            <!-- Category Breakdown (F4 requirement) -->
            <div class="section">
              <div class="section-header">
                <h3>ğŸ“Š Pengeluaran per Kategori</h3>
                <span class="balance-date">Bulan ini</span>
              </div>
              <div class="chart-container-simple">
                <canvas
                  id="dashboardCategoryChart"
                  width="300"
                  height="300"
                ></canvas>
              </div>
              <div id="categoryBreakdown" class="category-breakdown">
                <div class="empty-state">
                  ğŸ“Š
                  <p>Belum ada pengeluaran bulan ini</p>
                  <small
                    >Mulai catat pengeluaran untuk melihat distribusi
                    kategori</small
                  >
                </div>
              </div>
            </div>

            <!-- Recent Transactions -->
            <div class="section">
              <div class="section-header">
                <h3>Transaksi Terkini</h3>
                <button class="btn-text" data-tab="history">Lihat Semua</button>
              </div>
              <div id="recentTransactions" class="transaction-list">
                <div class="empty-state">
                  ğŸ“­
                  <p>Belum ada transaksi hari ini</p>
                  <button class="btn-secondary" data-tab="add-transaction">
                    ğŸš€ Mulai Catat
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Add Transaction Tab -->
        <section id="add-transaction" class="tab-content">
          <div class="container">
            <div class="transaction-type-tabs">
              <button class="type-tab active" data-type="expense">
                â– Pengeluaran
              </button>
              <button class="type-tab" data-type="income">â• Pemasukan</button>
            </div>

            <form id="transactionForm" class="transaction-form">
              <input
                type="hidden"
                id="transactionType"
                name="type"
                value="expense"
              />

              <div class="form-group">
                <label for="amount">ğŸ’° Jumlah</label>
                <div class="amount-input">
                  <span class="currency">Rp</span>
                  <input
                    type="number"
                    id="amount"
                    name="amount"
                    placeholder="0"
                    required
                    min="1"
                    step="1"
                    autofocus
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="category">ğŸ“‚ Kategori</label>
                <select id="category" name="category" required>
                  <!-- Categories populated by JS -->
                </select>
              </div>

              <div class="form-group">
                <label for="description">ğŸ“ Deskripsi (opsional)</label>
                <input
                  type="text"
                  id="description"
                  name="description"
                  placeholder="Contoh: Makan siang di warung"
                />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="date">ğŸ“… Tanggal</label>
                  <input type="date" id="date" name="date" required />
                </div>

                <div class="form-group">
                  <label for="time">ğŸ• Waktu</label>
                  <input type="time" id="time" name="time" required />
                </div>
              </div>

              <button type="submit" class="btn-primary btn-large">
                ğŸ’¾ Simpan Transaksi
              </button>
            </form>
          </div>
        </section>

        <!-- History Tab -->
        <section id="history" class="tab-content">
          <div class="container">
            <!-- Filter Controls -->
            <div class="filter-controls">
              <div class="filter-group">
                <select id="filterMonth">
                  <option value="">ğŸ“… Semua Bulan</option>
                </select>
                <select id="filterType">
                  <option value="">ğŸ“Š Semua Jenis</option>
                  <option value="income">â• Pemasukan</option>
                  <option value="expense">â– Pengeluaran</option>
                </select>
                <select id="filterCategory">
                  <option value="">ğŸ“‚ Semua Kategori</option>
                </select>
              </div>
              <button id="clearFilters" class="btn-secondary">ğŸ”„ Reset</button>
            </div>

            <!-- Summary -->
            <div class="history-summary">
              <div class="summary-item income">
                <span class="label">Total Pemasukan</span>
                <span class="amount" id="totalIncomeFiltered">Rp 0</span>
              </div>
              <div class="summary-item expense">
                <span class="label">Total Pengeluaran</span>
                <span class="amount" id="totalExpenseFiltered">Rp 0</span>
              </div>
              <div class="summary-item">
                <span class="label">ğŸ’¡ Selisih</span>
                <span class="amount" id="netAmountFiltered">Rp 0</span>
              </div>
            </div>

            <!-- Transaction List -->
            <div id="transactionList" class="transaction-list">
              <div class="empty-state">
                ğŸ“­
                <p>Tidak ada data transaksi</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Analytics Tab -->
        <section id="analytics" class="tab-content">
          <div class="container">
            <!-- Chart Controls -->
            <div class="chart-controls">
              <select id="chartPeriod">
                <option value="month">ğŸ“… Bulan Ini</option>
                <option value="week">ğŸ“… Minggu Ini</option>
                <option value="year">ğŸ“… Tahun Ini</option>
              </select>
              <button
                id="exportBtn"
                class="btn-secondary premium-feature"
                title="Fitur Premium"
                onclick="showPremiumFeature()"
              >
                ğŸ“¥ Export Data
              </button>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
              <div class="chart-container">
                <h3>ğŸ“Š Pengeluaran per Kategori</h3>
                <canvas id="categoryChart"></canvas>
              </div>
              <div class="chart-container">
                <h3>ğŸ“ˆ Tren Pemasukan vs Pengeluaran</h3>
                <canvas id="trendChart"></canvas>
              </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
              <div class="stat-card">
                <h4>ğŸ“Š Rata-rata Pengeluaran Harian</h4>
                <p class="stat-value" id="dailyAverage">Rp 0</p>
              </div>
              <div class="stat-card">
                <h4>ğŸ”¥ Kategori Pengeluaran Tertinggi</h4>
                <p class="stat-value" id="topCategory">-</p>
              </div>
              <div class="stat-card">
                <h4>ğŸ“‹ Total Transaksi</h4>
                <p class="stat-value" id="totalTransactions">0</p>
              </div>
              <div class="stat-card">
                <h4>ğŸ’° Rasio Menabung</h4>
                <p class="stat-value" id="savingsRatio">0%</p>
              </div>
            </div>

            <!-- Premium Features Ad -->
            <div class="premium-ad">
              <div class="premium-content">
                <h3>ğŸš€ Upgrade ke Premium</h3>
                <p>
                  Dapatkan laporan detail, export data, dan fitur analisis
                  lanjutan
                </p>
                <ul>
                  <li>âœ… Export ke CSV dan PDF</li>
                  <li>âœ… Anggaran kategori tanpa batas</li>
                  <li>âœ… Analisis tren mendalam</li>
                  <li>âœ… Sinkronisasi antar perangkat</li>
                </ul>
                <button class="btn-premium" onclick="showPremiumFeature()">
                  ğŸ‘‘ Upgrade Sekarang - Rp 29.000/bulan
                </button>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- Bottom Navigation -->
      <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="dashboard">
          ğŸ <br />Dashboard
        </button>
        <button class="nav-tab" data-tab="add-transaction" id="quickAddBtn">
          â•<br />Tambah
        </button>
        <button class="nav-tab" data-tab="history">ğŸ“‹<br />Riwayat</button>
      </nav>
    </div>

    <!-- Quick Add Floating Button (FR-002: Fast Input) -->
    <button
      id="quickAddFloat"
      class="quick-add-floating"
      onclick="showQuickAdd('expense')"
      title="Tambah Pengeluaran Cepat"
    >
      â•
    </button>

    <!-- Modals -->
    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ‘¤ Profil Pengguna</h3>
          <button class="modal-close" onclick="closeModal('profileModal')">
            &times;
          </button>
        </div>
        <div class="profile-content">
          <div class="profile-info">
            <div class="avatar">ğŸ‘¤</div>
            <h4 id="userName">Nama Pengguna</h4>
            <p id="userEmail">email@example.com</p>
          </div>
          <div class="profile-stats">
            <div class="stat">
              <span class="number" id="totalDays">0</span>
              <span class="label">Hari Aktif</span>
            </div>
            <div class="stat">
              <span class="number" id="totalTransactionsProfile">0</span>
              <span class="label">Transaksi</span>
            </div>
          </div>
          <div class="profile-actions">
            <button class="btn-secondary" onclick="exportData()">
              ğŸ“¥ Export Data
            </button>
            <button class="btn-danger" onclick="logout()">ğŸšª Keluar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>âœï¸ Edit Transaksi</h3>
          <button class="modal-close" onclick="closeModal('editModal')">
            &times;
          </button>
        </div>
        <form id="editForm" class="modal-form">
          <input type="hidden" id="editId" name="id" />
          <input type="hidden" id="editType" name="type" />

          <div class="form-group">
            <label for="editAmount">ğŸ’° Jumlah</label>
            <div class="amount-input">
              <span class="currency">Rp</span>
              <input
                type="number"
                id="editAmount"
                name="amount"
                required
                min="1"
                step="1"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="editCategory">ğŸ“‚ Kategori</label>
            <select id="editCategory" name="category" required>
              <!-- Categories populated by JS -->
            </select>
          </div>

          <div class="form-group">
            <label for="editDescription">ğŸ“ Deskripsi</label>
            <input type="text" id="editDescription" name="description" />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="editDate">ğŸ“… Tanggal</label>
              <input type="date" id="editDate" name="date" required />
            </div>
            <div class="form-group">
              <label for="editTime">ğŸ• Waktu</label>
              <input type="time" id="editTime" name="time" required />
            </div>
          </div>

          <div class="modal-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeModal('editModal')"
            >
              âŒ Batal
            </button>
            <button type="submit" class="btn-primary">ğŸ’¾ Simpan</button>
            <button type="button" class="btn-danger" id="deleteBtn">
              ğŸ—‘ï¸ Hapus
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Quick Add Modal -->
    <div id="quickAddModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="quickAddTitle">â• Tambah Transaksi</h3>
          <button class="modal-close" onclick="closeModal('quickAddModal')">
            &times;
          </button>
        </div>
        <form id="quickAddForm" class="modal-form">
          <input type="hidden" id="quickAddType" name="type" />

          <div class="form-group">
            <label for="quickAddAmount">ğŸ’° Jumlah</label>
            <div class="amount-input">
              <span class="currency">Rp</span>
              <input
                type="number"
                id="quickAddAmount"
                name="amount"
                required
                min="1"
                step="1"
                placeholder="0"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="quickAddCategory">ğŸ“‚ Kategori</label>
            <select id="quickAddCategory" name="category" required>
              <!-- Categories populated by JS -->
            </select>
          </div>

          <div class="form-group">
            <label for="quickAddDescription">ğŸ“ Deskripsi (opsional)</label>
            <input
              type="text"
              id="quickAddDescription"
              name="description"
              placeholder="Catatan singkat"
            />
          </div>

          <div class="modal-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeModal('quickAddModal')"
            >
              âŒ Batal
            </button>
            <button type="submit" class="btn-primary">ğŸ’¾ Simpan</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Budget Modal (F6 requirement) -->
    <div id="budgetModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ¯ Atur Anggaran Bulanan</h3>
          <button class="modal-close" onclick="closeModal('budgetModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="budgetForm">
            <div class="form-group">
              <label for="monthlyBudget">ğŸ’° Anggaran Bulanan</label>
              <div class="amount-input">
                <span class="currency">Rp</span>
                <input
                  type="number"
                  id="monthlyBudget"
                  name="budget"
                  placeholder="0"
                  min="0"
                  step="10000"
                  required
                />
              </div>
              <small class="form-help">
                Tetapkan target maksimal pengeluaran per bulan
              </small>
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('budgetModal')"
              >
                Batal
              </button>
              <button type="submit" class="btn-primary">
                ğŸ’¾ Simpan Anggaran
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/security.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/charts.js"></script>
  </body>
</html>
